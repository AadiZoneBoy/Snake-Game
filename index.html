<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover" />
<title>Snake Deluxe üçè</title>
<style>
  :root{--bg:#d0c08a;--panel:#f5e298;--accent:#3a9d5d;--muted:#7a6b45;--button:#4caf50;}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,sans-serif;background:var(--bg);}
  .app{min-height:100%;display:flex;flex-direction:column;align-items:center;gap:10px;padding:10px;}
  h1{margin:6px 0;font-size:22px;color:var(--muted);}
  .game-wrap{display:flex;flex-direction:column;align-items:center;gap:8px;width:100%;max-width:820px;}
  .canvas-container{position:relative;width:100%;padding-top:75%;}
  canvas{position:absolute;left:0;top:0;width:100%;height:100%;background:var(--panel);
         border:8px solid #b59c67;border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,0.2);}
  #hud{display:flex;gap:12px;align-items:center;color:#2c2a21;font-size:15px}
  .btn{padding:6px 12px;border:none;border-radius:8px;background:var(--button);color:white;font-weight:600;cursor:pointer;}
  .controls{display:flex;gap:6px;flex-wrap:wrap}
  .dpad{position:relative;width:200px;height:200px;display:grid;grid-template-columns:1fr 1fr 1fr;grid-template-rows:1fr 1fr 1fr;gap:6px;align-items:center;justify-items:center;}
  .dpad button{width:60px;height:60px;border-radius:12px;border:none;background:#eee;font-size:22px;color:#222;}
  .blank{visibility:hidden}
  .overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
    background:rgba(0,0,0,0.35);backdrop-filter:blur(2px);color:#fff;font-size:22px;z-index:40;border-radius:16px;}
  .overlay .panel{background:rgba(0,0,0,0.55);padding:18px;border-radius:12px;text-align:center}
  .countdown{font-size:60px;font-weight:900;animation:pop 1s forwards;}
  @keyframes pop{0%{transform:scale(0.2);opacity:0;}50%{transform:scale(1.2);opacity:1;}100%{transform:scale(1);opacity:0.8;}}
  footer{font-size:12px;color:#4a4128;margin-top:8px}
</style>
</head>
<body>
<div class="app">
  <h1>üêç Snake Eating</h1>

  <div class="game-wrap">
    <div id="hud">
      <div>Score: <b id="score">0</b></div>
      <div>Level: <b id="level">1</b></div>
      <div>High: <b id="high">0</b></div>
      <div class="controls">
        <button id="startBtn" class="btn">Start</button>
        <button id="pauseBtn" class="btn">Pause</button>
        <button id="restartBtn" class="btn">Restart</button>
      </div>
    </div>

    <div class="canvas-container">
      <canvas id="game" width="640" height="480"></canvas>
      <div id="overlay" class="overlay" style="display:none;">
        <div class="panel">
          <div id="overlayTitle" style="font-size:20px;font-weight:700">Paused</div>
          <div id="overlayText" style="margin-top:6px"></div>
          <div style="margin-top:12px;display:flex;gap:10px;justify-content:center;">
            <button id="overlayResume" class="btn">Resume</button>
            <button id="overlayRestart" class="btn">Restart</button>
          </div>
        </div>
      </div>
      <div id="countdownOverlay" class="overlay" style="display:none;background:rgba(0,0,0,0.5);">
        <div id="countdownNum" class="countdown">3</div>
      </div>
    </div>

    <div class="dpad">
      <div class="blank"></div>
      <button data-dir="UP">‚ñ≤</button>
      <div class="blank"></div>
      <button data-dir="LEFT">‚óÄ</button>
      <div class="blank"></div>
      <button data-dir="RIGHT">‚ñ∂</button>
      <div class="blank"></div>
      <button data-dir="DOWN">‚ñº</button>
    </div>
  </div>

  <footer>Swipe on canvas or use arrows/WASD --Aaditya Kumar Singh.</footer>
</div>

<!-- Sounds -->
<audio id="eatSnd" preload="auto">
  <source src="https://cdn.pixabay.com/download/audio/2022/07/17/audio_dd8c6c5b8a.mp3?filename=ting-1-120869.mp3" type="audio/mpeg">
</audio>
<audio id="dieSnd" preload="auto">
  <source src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_7d0d6a2f9a.mp3?filename=short-game-over-sound-110560.mp3" type="audio/mpeg">
</audio>

<script>
const canvas=document.getElementById('game'),ctx=canvas.getContext('2d');
const appleImg=new Image(); appleImg.src="https://cdn-icons-png.flaticon.com/512/415/415733.png";

let box=20,cols=32,rows=24,snake=[],dir='RIGHT',nextDir=null,food,score=0,level=1,speed=140,minSpeed=60,timer=0,running=false,paused=false,particles=[],countdownActive=false;
let high=localStorage.getItem("snake.high")||0;document.getElementById("high").textContent=high;
const scoreEl=document.getElementById("score"),levelEl=document.getElementById("level"),highEl=document.getElementById("high");
const overlay=document.getElementById("overlay"),overlayTitle=document.getElementById("overlayTitle"),overlayText=document.getElementById("overlayText"),overlayResume=document.getElementById("overlayResume"),overlayRestart=document.getElementById("overlayRestart");
const countdownOverlay=document.getElementById("countdownOverlay"),countdownNum=document.getElementById("countdownNum");
const eatSnd=document.getElementById("eatSnd"),dieSnd=document.getElementById("dieSnd");

function reset(){snake=[{x:10,y:12},{x:9,y:12},{x:8,y:12}];dir="RIGHT";nextDir=null;score=0;level=1;speed=140;spawnFood();updateHUD();}
function spawnFood(){food={x:Math.floor(Math.random()*cols),y:Math.floor(Math.random()*rows)};}
function updateHUD(){scoreEl.textContent=score;levelEl.textContent=level;}
function saveHigh(){if(score>high){high=score;localStorage.setItem("snake.high",high);highEl.textContent=high;}}
function play(a){a.currentTime=0;a.play().catch(()=>{});}

function step(){
  const head={...snake[0]};
  if(nextDir){dir=nextDir;nextDir=null;}
  if(dir==="LEFT")head.x--;if(dir==="RIGHT")head.x++;if(dir==="UP")head.y--;if(dir==="DOWN")head.y++;
  if(head.x<0||head.y<0||head.x>=cols||head.y>=rows||snake.some(s=>s.x===head.x&&s.y===head.y)){gameOver();return;}
  snake.unshift(head);
  if(head.x===food.x&&head.y===food.y){score++;play(eatSnd);if(score%5===0){level++;speed=Math.max(minSpeed,speed-10);}updateHUD();spawnFood();spawnParticles(head.x*box+box/2,head.y*box+box/2);}else{snake.pop();}
}
function gameOver(){running=false;play(dieSnd);overlay.style.display="flex";overlayTitle.textContent="Game Over";overlayText.textContent=`Score: ${score}`;saveHigh();}
function spawnParticles(x,y){for(let i=0;i<15;i++)particles.push({x,y,vx:(Math.random()-0.5)*3,vy:(Math.random()-0.5)*3,life:1});}
function updateParticles(dt){particles.forEach(p=>{p.x+=p.vx*dt*0.1;p.y+=p.vy*dt*0.1;p.life-=dt*0.001;});particles=particles.filter(p=>p.life>0);}
function draw(){
  ctx.fillStyle="#f5e298";ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(appleImg,food.x*box,food.y*box,box,box);
  for(let i=0;i<snake.length;i++){
    const s=snake[i];ctx.beginPath();
    ctx.fillStyle=i===0?"#2b7f46":"#3a9d5d";
    ctx.roundRect(s.x*box+2,s.y*box+2,box-4,box-4,8);ctx.fill();
    if(i===0){ctx.fillStyle="#000";ctx.beginPath();ctx.arc(s.x*box+box*0.7,s.y*box+box*0.3,2,0,Math.PI*2);ctx.fill();}
  }
  particles.forEach(p=>{ctx.fillStyle=`rgba(255,50,50,${p.life})`;ctx.beginPath();ctx.arc(p.x,p.y,4*p.life,0,Math.PI*2);ctx.fill();});
}
function loop(ts){if(!running){draw();requestAnimationFrame(loop);return;}if(paused||countdownActive){draw();requestAnimationFrame(loop);return;}if(ts>=timer){step();timer=ts+speed;}updateParticles(16);draw();requestAnimationFrame(loop);}

/* ---- Beep sound generator using Web Audio ---- */
function beep(freq=600,duration=200){
  try{
    const ctxAudio=new (window.AudioContext||window.webkitAudioContext)();
    const osc=ctxAudio.createOscillator();
    const gain=ctxAudio.createGain();
    osc.type="sine";osc.frequency.value=freq;
    osc.connect(gain);gain.connect(ctxAudio.destination);
    osc.start();
    gain.gain.setValueAtTime(0.2,ctxAudio.currentTime);
    osc.stop(ctxAudio.currentTime+duration/1000);
  }catch(e){}
}

/* Countdown before resume/restart */
function startCountdown(cb){
  countdownActive=true;
  let n=3;
  countdownOverlay.style.display="flex";
  countdownNum.textContent=n;
  beep();
  let interval=setInterval(()=>{
    n--;
    if(n>0){countdownNum.textContent=n;beep();}
    else if(n===0){countdownNum.textContent="Go!";beep(900);}
    else{clearInterval(interval);countdownOverlay.style.display="none";countdownActive=false;cb();}
  },1000);
}

/* Controls */
const opposites={LEFT:"RIGHT",RIGHT:"LEFT",UP:"DOWN",DOWN:"UP"};
document.addEventListener("keydown",e=>{if(["ArrowLeft","a"].includes(e.key)&&dir!=="RIGHT")nextDir="LEFT";
 if(["ArrowRight","d"].includes(e.key)&&dir!=="LEFT")nextDir="RIGHT";
 if(["ArrowUp","w"].includes(e.key)&&dir!=="DOWN")nextDir="UP";
 if(["ArrowDown","s"].includes(e.key)&&dir!=="UP")nextDir="DOWN";
 if(e.key===" ")togglePause();});
document.querySelectorAll(".dpad button").forEach(b=>b.onclick=()=>{const d=b.dataset.dir;if(opposites[d]!==dir)nextDir=d;});
canvas.addEventListener("touchstart",e=>{touch={x:e.touches[0].clientX,y:e.touches[0].clientY};},{passive:true});
canvas.addEventListener("touchend",e=>{const dx=e.changedTouches[0].clientX-touch.x,dy=e.changedTouches[0].clientY-touch.y;
 if(Math.abs(dx)>Math.abs(dy)){if(dx>20&&dir!=="LEFT")nextDir="RIGHT";else if(dx<-20&&dir!=="RIGHT")nextDir="LEFT";}
 else{if(dy>20&&dir!=="UP")nextDir="DOWN";else if(dy<-20&&dir!=="DOWN")nextDir="UP";}});

function startGame(){reset();running=true;paused=false;overlay.style.display="none";startCountdown(()=>{timer=performance.now()+speed;requestAnimationFrame(loop);});}
function togglePause(){if(!running)return;if(!paused){paused=true;overlay.style.display="flex";overlayTitle.textContent="Paused";overlayText.textContent="";}else{overlay.style.display="none";paused=false;startCountdown(()=>{});}}
function restartGame(){reset();running=true;paused=false;overlay.style.display="none";startCountdown(()=>{timer=performance.now()+speed;requestAnimationFrame(loop);});}

overlayResume.onclick=()=>togglePause();
overlayRestart.onclick=restartGame;
document.getElementById("startBtn").onclick=startGame;
document.getElementById("pauseBtn").onclick=togglePause;
document.getElementById("restartBtn").onclick=restartGame;

if(!CanvasRenderingContext2D.prototype.roundRect){CanvasRenderingContext2D.prototype.roundRect=function(x,y,w,h,r){this.moveTo(x+r,y);this.lineTo(x+w-r,y);this.quadraticCurveTo(x+w,y,x+w,y+r);this.lineTo(x+w,y+h-r);this.quadraticCurveTo(x+w,y+h,x+w-r,y+h);this.lineTo(x+r,y+h);this.quadraticCurveTo(x,y+h,x,y+h-r);this.lineTo(x,y+r);this.quadraticCurveTo(x,y,x+r,y);};}

reset();draw();
</script>
</body>
</html>
